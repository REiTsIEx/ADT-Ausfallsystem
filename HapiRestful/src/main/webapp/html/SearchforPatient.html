<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Patientensuche</title>
<link rel="stylesheet" type="text/css" href="../css/SearchforPatientStyles.css">
<!-- <script type="text/javascript" src="../js/Methods.js"></script> -->

</head>


<body>
<div>
<ulBar>
  <liBar><a  href="HomeScreen.html"><b>Hauptseite</b></a></liBar>
</ulBar>
</div>

<div class="header"><br>Patientensuche</div>

<div class="row">
<div class="col-3 menu">
<ul>
<li>Sozialversicherungsnummer: <br><input  type="text" placeholder="Optional" id="svnSearch" name = "svnField"></li>

<li>Nachname: <br><input  type="text" placeholder="Optional" id="lastnameSearch" name = "lastnameField"></li>

<li>Vorname:  <br><input  type="text" placeholder="Optional" id="firstnameSearch" name="firstnameField"></li>

<li class="button" onclick="searchPatient()">Suche Patient</li>

</ul>

</div>

<div class ="col-3 menu">

<ul id="demo">


</ul>

</div>

</div>


<script src='http://code.jquery.com/jquery-2.1.4.min.js'></script>
<script src='../js/fhir-client.js'></script>
<script>
var patientArray = [];
var list = document.getElementById('demo');
function searchPatient() {
	
	$(demo).empty();
	
	

	var entry = document.createElement('li')
	entry.className = "patientListbutton";
	entry.addEventListener("click",showPatient)
	
	  var smart = new FHIR.client({
		    serviceUrl: "https://fhir-open-api-dstu2.smarthealthit.org",

		    auth: {
		      type: 'none'
		    }
		  });

if(svnSearch.value != "") {

	  smart.api.search({type: "Patient", query: {identifier:{value : svnSearch.value} }
		}).then(function(patientList){
			var arrayCount = patientList.data.total;
			
			patientList.data.entry.forEach(function(patient){
				console.log(patientList);
				var nameg = patient.resource;
				var namePat = nameg.name[0];
				var familyName = namePat.family;
				var givenName = namePat.given;
				
				entry.appendChild(document.createTextNode(familyName + " " + givenName));
				list.appendChild(entry);
				
			});
		       
		});
}else{

  smart.api.search({type: "Patient", query: {family: lastnameSearch.value, given: firstnameSearch.value}
	}).then(function(patientList){
		console.log(patientList);
		
		if(patientList.data.total != 0) {
			//Legt die Länge des Array fest
		patientList.data.entry.forEach(function(patient){
			console.log(patient);
			var resource = patient.resource;
			var address = resource.address[0];
			var name = resource.name[0];
			singlePatient = {
					
					svn : resource.identifier[0].value,
					gender : resource.gender,
					familyName : name.family,
					givenName : name.given,
					birthdate : resource.birthDate,
					city: address.city,
					country : address.country
					
					
					
			};
			entry.appendChild(document.createTextNode(singlePatient.givenName + " " + singlePatient.familyName + " " + singlePatient.birthdate));
			list.appendChild(entry);
			patientArray.push(singlePatient);
			
			console.log(singlePatient);
		});
		}else{
		alert("Keine Ergebnisse");	
		}
	});
}
}
function showPatient(){
	    console.log($(this).parent('li').index()+1);
	    var index = $(this).parent('li').index()+1;
	    console.log(JSON.stringify(patientArray[0].givenName));
			}
</script>

</body>


</html>
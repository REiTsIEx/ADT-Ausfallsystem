<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ADT-Ausfallsystem</title>
<link rel="stylesheet" type="text/css" href="../css/SearchforPatientStyles.css">
<!-- <script type="text/javascript" src="../js/Methods.js"></script> -->

</head>


<body>
<div>
<ulBar>
  <liBar><a  href="HomeScreen.html"><b>Hauptseite</b></a></liBar>
</ulBar>
</div>

<div class="header"><br>Patientensuche</div>

<div class="row">
<div class="col-3 menu">
<ul>
<li>Sozialversicherungsnummer: <br><input  type="text" placeholder="Optional" id="svnSearch" name = "svnField"></li>

<li>Nachname: <br><input  type="text" placeholder="Optional" id="lastnameSearch" name = "lastnameField"></li>

<li>Vorname:  <br><input  type="text" placeholder="Optional" id="firstnameSearch" name="firstnameField"></li>

<li class="button" onclick="searchPatient()">Suche Patient</li>

</ul>
</div>
</div>

<div class="row">
<div class ="col-7 menu">

<ul id="demo">


</ul>

</div>

</div>


<script src='http://code.jquery.com/jquery-2.1.4.min.js'></script>
<script src='../js/fhir-client.js'></script>
<script>
function searchPatient() {
	
	
	  var smart = new FHIR.client({
		    serviceUrl: 'https://fhir-open-api-dstu2.smarthealthit.org',

		    auth: {
		      type: 'none'
		    }
		  });

if(svnSearch.value != "") {

	  smart.api.search({type: "Patient", query: {identifier: svnSearch.value }
		}).then(function(r){
			r.data.entry.forEach(function(re){
				var resource = re.resource;
				var name = resource.active
				console.log("yolo"+name);
// 				var formatted = ("<li>"  +name.given.join(" ") + " " + name.family + "</li>");
// 				$("#demo").append(formatted);
// 				console.log(JSON.stringify(r,null,2));

				
			});
		       
		});
}else{

  smart.api.search({type: "Patient", query: {family: lastnameSearch.value, given: firstnameSearch.value}
	}).then(function(patientList){
		patientList.data.entry.forEach(function(patient){
			
			var name = patient.resource.id;
			console.log(JSON.stringify(patient,null,2));
			console.log(name);
//				var formatted = ("<li>"  +name.given.join(" ") + " " + name.family + "</li>");
//				$("#demo").append(formatted);
//				console.log(JSON.stringify(r,null,2));
		});
	});
}
}
</script>

</body>


</html>
<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Patientensuche</title>
<link rel="stylesheet" type="text/css" href="../css/SearchforPatientStyles.css">
<!-- <script type="text/javascript" src="../js/Methods.js"></script> -->

</head>


<body>
<div>
<ulBar>
  <liBar><a  href="HomeScreen.html"><b>Hauptseite</b></a></liBar>
</ulBar>
</div>

<div class="header"><br>Patientensuche</div>

<div class="row">
<div class="col-3 menu">
<ul>
<li>Sozialversicherungsnummer: <br><input  type="text" placeholder="Optional" id="svnSearch" name = "svnField"></li>

<li>Nachname: <br><input  type="text" placeholder="Optional" id="lastnameSearch" name = "lastnameField"></li>

<li>Vorname:  <br><input  type="text" placeholder="Optional" id="firstnameSearch" name="firstnameField"></li>

<li class="button" onclick="searchPatient()">Suche Patient</li>

</ul>
</div>
</div>

<div class="row">
<div class ="col-4 menu">

<ul id="demo">


</ul>

</div>

</div>


<script src='http://code.jquery.com/jquery-2.1.4.min.js'></script>
<script src='../js/fhir-client.js'></script>
<script>
function searchPatient() {
	
	$(demo).empty();
	var singlePatient = {};
	var list = document.getElementById('demo');

	var entry = document.createElement('li')
	entry.className = "patientListbutton";
	
	
	  var smart = new FHIR.client({
		    serviceUrl: "https://fhir-open-api-dstu2.smarthealthit.org",

		    auth: {
		      type: 'none'
		    }
		  });

if(svnSearch.value != "") {

	  smart.api.search({type: "Patient", query: {identifier:{value : svnSearch.value} }
		}).then(function(patientList){
			var arrayCount = r.data.total;
			r.data.entry.forEach(function(patient){
				console.log(patientList);
				var nameg = patient.resource;
				var namePat = nameg.name[0];
				var familyName = namePat.family;
				var givenName = namePat.given;
				
				entry.appendChild(document.createTextNode(familyName + " " + givenName));
				list.appendChild(entry);
				
			});
		       
		});
}else{

  smart.api.search({type: "Patient", query: {family: lastnameSearch.value, given: firstnameSearch.value}
	}).then(function(patientList){
		console.log(patientList);
		var arrayCount = r.data.total;
		if(arrayCount != 0) {
			patientArray = new Array[arrayCount];
			var index = 0;
		patientList.data.entry.forEach(function(patient){
			console.log(patientList);
			var resource = patient.resource;
			var address = resource.address[0];
			var name = resource.name[0];
			singlePatient = {
					svn : resource.identifier[0].value,
					gender : resource.gender,
					familyName : name.family,
					givenName : name.given,
					birthdate : resource.birthdate,
					city: address.city,
					country : address.country
					
					
					
			};
			entry.appendChild(document.createTextNode(JSON.stringify(singlePatient)));
			list.appendChild(entry);
			console.log(singlePatient);
			index++;
		});
		}else{
		alert("Keine Ergebnisse");	
		}
	});
}
}
// function access(singlePatient){
// 	}
// 	patient.firstname = 
// 	patient.lastname = 
// 	patient.Last = 
// 	//var formData = JSON.stringify(options); <!--Puts form data in one variable-->

// 	$.ajax({
// 	    url: "someURL",
// 	    type: "POST",
// 	    data: formData ,
// 	    success function() { window.location = 'somePage.htm' },
// 	    failure function () {
// 	         window.location = 'errorPage.htm?first=' + options.First +'&last=' + options.Last
// 	    }
// 	});
// 	}
</script>

</body>


</html>